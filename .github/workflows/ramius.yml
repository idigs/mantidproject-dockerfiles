

name: ramius
on: workflow_dispatch

jobs:
  job_debug:
    runs-on: ubuntu-latest
    steps:
      - if: true
        name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - if: true
        name: Dump job context
        env:
          JOB_CONTEXT: ${{ toJson(job) }}
        run: echo "$JOB_CONTEXT"
      - if: true
        name: Dump steps context
        env:
          STEPS_CONTEXT: ${{ toJson(steps) }}
        run: echo "$STEPS_CONTEXT"
      - if: true
        name: Dump runner context
        env:
          RUNNER_CONTEXT: ${{ toJson(runner) }}
        run: echo "$RUNNER_CONTEXT"
      - name: dump shell env vars
        run: |
          env -0 | while IFS='' read -d '' line ; do printf '%s\t: %s\n' "${line%%=*}" "${line#*=}" | expand -t 30 | sed ':a;N;$!ba;s/\n/ /g'; done | LC_COLLATE=C sort -b

  job_setup:
    runs-on: ubuntu-latest
    steps:
      - id: semver_tag
        name: retrieve semantic version of latest tag
        run: |
          read -r semver_tag <<< $(./utils/equate_tag_semver "library/almalinux:latest")
          test -n ${semver_tag} || exit 1
          echo "semver_tag=${semver_tag}" >> $GITHUB_OUTPUT
    outputs:
      semver_tag: ${{ steps.semver_tag.outputs.semver_tag }}


  job_docker:
    if: false
    runs-on: ubuntu-latest
    needs: [ job_setup ]
    steps:
      - name: setup buildx
        uses: docker/setup-buildx-action@v3

      - name: build and push - mantid development image
        uses: docker/build-push-action@v6
        with:
          context: ./Linux/development/docker
          push: true
          tags: ghcr.io/mantidproject/mantid-development-alma9:${{ needs.job_setup.outputs.semver_tag }}


